<?php

declare(strict_types=1);

namespace DoctrineMigrations;

use Doctrine\DBAL\Schema\Schema;
use Doctrine\Migrations\AbstractMigration;

/**
 * Auto-generated Migration: Please modify to your needs!
 */
final class Version20201110084744 extends AbstractMigration
{
    public function getDescription() : string
    {
        return '';
    }

    public function up(Schema $schema) : void
    {
        // this up() migration is auto-generated, please modify it to your needs
        $this->addSql('CREATE TABLE change_log (id INT AUTO_INCREMENT NOT NULL, entity_id INT DEFAULT NULL COMMENT \'ID de l\'\'entité\', action_type VARCHAR(255) NOT NULL COMMENT \'Action sur l\'\'entité à répercuter dans l\'\'index\', entity_name VARCHAR(255) NOT NULL COMMENT \'Nom de l\'\'entité sur laquelle porte l\'\'action à répercuter.\', PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB');
        $this->addSql('CREATE TABLE extended_field (id INT AUTO_INCREMENT NOT NULL, project_id INT DEFAULT NULL, field_id VARCHAR(50) NOT NULL, project VARCHAR(50) NOT NULL, data_type ENUM(\'Booléen\', \'Texte\', \'Date\', \'Entier\', \'Décimal\') NOT NULL COMMENT \'Type de champ - Texte, Entier, Décimal, Date, Booléen(DC2Type:fielddatatypeenum)\', is_visible TINYINT(1) NOT NULL COMMENT \'Champ invisible de l\'\'utilisateur mais nécessaire au projet\', is_mandatory TINYINT(1) NOT NULL COMMENT \'Indique si le champ est obligatoire pour envoyer la donnée ou non\', min_value NUMERIC(10, 0) DEFAULT NULL, max_value NUMERIC(10, 0) DEFAULT NULL, `regexp` VARCHAR(255) DEFAULT NULL COMMENT \'Format de la valeur (ex adresse mail, numéro de tel)\', unit VARCHAR(255) DEFAULT NULL COMMENT \'Unité\', INDEX IDX_76A19DBE166D1F9C (project_id), UNIQUE INDEX key_fieldid_project (field_id, project), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB COMMENT = \'Champs étendus\' ');
        $this->addSql('CREATE TABLE extended_field_occurrence (id INT AUTO_INCREMENT NOT NULL, occurrence_id INT NOT NULL, extended_field_id INT NOT NULL, value LONGTEXT NOT NULL COMMENT \'Valeur renseignée par l\'\'utilisateur\', INDEX IDX_7DFE29EF30572FAC (occurrence_id), INDEX IDX_7DFE29EFCCBF7175 (extended_field_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB');
        $this->addSql('CREATE TABLE extendedfield_translation (id INT AUTO_INCREMENT NOT NULL, extended_field_id INT DEFAULT NULL, project VARCHAR(50) NOT NULL, label VARCHAR(255) NOT NULL COMMENT \'Intitulé\', description VARCHAR(255) DEFAULT NULL COMMENT \'Description du champ\', default_value TINYTEXT DEFAULT NULL COMMENT \'Valeur par défaut\', error_message VARCHAR(255) DEFAULT NULL COMMENT \'Message d\'\'erreur\', language_iso_code VARCHAR(3) DEFAULT NULL COMMENT \'Code iso de la langue\', help VARCHAR(15) DEFAULT NULL, INDEX IDX_169442A8CCBF7175 (extended_field_id), UNIQUE INDEX index_fild_project_language (extended_field_id, project, language_iso_code), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB COMMENT = \'Contient le label et les valeurs par défaut d\'\'un champ supplémentaire.\' ');
        $this->addSql('CREATE TABLE occurrence (id INT AUTO_INCREMENT NOT NULL, project_id INT DEFAULT NULL, user_id INT DEFAULT NULL COMMENT \'id de l\'\'utilisateur ayant saisi l\'\'obs (seulement identification de tela, si utilisateur non inscrit ce champ est vide)\', user_email VARCHAR(255) NOT NULL COMMENT \'Email de l\'\'utilisateur ayant saisi l\'\'obs\', user_pseudo VARCHAR(100) DEFAULT NULL COMMENT \'Pseudo de l\'\'utilisateur ayant saisi l\'\'obs. Nom/Prénom si non renseigné.\', observer VARCHAR(100) NOT NULL COMMENT \'Observateur\', observer_institution VARCHAR(100) DEFAULT NULL COMMENT \'Structure dans le cadre de laquelle l\'\'obs a été faite\', date_observed DATETIME DEFAULT NULL COMMENT \'Date d\'\'observation\', date_created DATETIME NOT NULL COMMENT \'Date de création de l\'\'obs\', date_updated DATETIME DEFAULT NULL COMMENT \'Date de la dernière modification de l\'\'obs\', date_published DATETIME DEFAULT NULL COMMENT \'Date de publication de l\'\'obs = transmission au réseau\', user_sci_name VARCHAR(255) DEFAULT NULL COMMENT \'Nom saisi par l\'\'utilisateur (nom scientifique ou autre terme qualifiant  l\'\'individu observé)\', user_sci_name_id INT DEFAULT NULL COMMENT \'Numéro du nom (ou numéro nomenclatural ou nn) saisi par l\'\'utilisateur, dans le cas où celui-ci est lié à un référentiel\', accepted_sci_name VARCHAR(255) DEFAULT NULL COMMENT \'Nom retenu\', accepted_sci_name_id INT DEFAULT NULL COMMENT \'Numéro du nom (ou numéro nomenclatural ou nn) retenu\', plantnet_id INT DEFAULT NULL COMMENT \'Identifiant plantnet\', family VARCHAR(50) DEFAULT NULL COMMENT \'Famille du taxon auquel appartient l\'\'observation\', certainty ENUM(\'à déterminer\', \'douteux\', \'certain\') DEFAULT NULL COMMENT \'Certitude de l identification taxonomique(DC2Type:certaintyenum)\', annotation LONGTEXT DEFAULT NULL COMMENT \'Commentaires concernant l\'\'obs\', occurrence_type ENUM(\'observation de terrain\', \'issue de la bibliographie\', \'donnée d\\\'herbier\') DEFAULT \'observation de terrain\' COMMENT \'Type de donnée - observation de terrain, issue de la bibliographie, donnée d\'\'herbier(DC2Type:occurrencetypeenum)\', is_wild TINYINT(1) DEFAULT \'1\' COMMENT \'Indique si l\'\'individu observé était sauvage ou cultivé\', coef VARCHAR(50) DEFAULT NULL, phenology ENUM(\'00-09: germination, développement des bourgeons\', \'10-19: développement des feuilles\', \'11: par ex, environ 10% des feuilles épanouies\', \'15: par ex, environ 50% des feuilles épanouies\', \'20-29: formation de pousses latérales, tallage\', \'30-39: développement des tiges, croissance des rosettes\', \'40-49: développement des organes de propagation végétative\', \'50-59: apparition de l\'\'inflorescence, épiaison\', \'60-69: floraison\', \'61: par ex, environ 10% des fleurs épanouies\', \'65: par ex, environ 50% des fleurs épanouies\', \'70-79: fructification\', \'80-89: maturité des fruits et des graines\', \'85: par ex, 50% des fruits matures\', \'90-99: sénescence et dormance\', \'91: environ 10% des feuilles sont tombées ou ont changé de couleur\', \'95: environ 50% des feuilles sont tombées ou ont changé de couleur\') DEFAULT NULL COMMENT \'Stade phénologique observé - échelle BBCH, stades regroupés par 10 (sauf certains stades remarquables)(DC2Type:phenologyenum)\', sample_herbarium TINYINT(1) DEFAULT \'0\' COMMENT \'Indique la présence / l\'\'absence d\'\'une part d\'\'herbier associée à l\'\'obs\', bibliography_source VARCHAR(255) DEFAULT NULL COMMENT \'Source bibliographique\', input_source ENUM(\'CEL\', \'widget\', \'VegLab\', \'PlantNet\', \'autre\') DEFAULT NULL COMMENT \'Interface utilisée pour la saisie de l\'\'obs - CEL, VegLab, widget,  PlantNet, autre(DC2Type:inputsourceenum)\', is_public TINYINT(1) DEFAULT \'0\' NOT NULL COMMENT \'Indique si l\'\'obs est publique ou non\', is_visible_in_cel TINYINT(1) DEFAULT \'1\' NOT NULL COMMENT \'Indique si l\'\'obs s\'\'affiche dans le CEL ou non\', is_visible_in_veg_lab TINYINT(1) DEFAULT \'0\' NOT NULL COMMENT \'Indique si l\'\'obs s\'\'affiche dans VegLab ou non\', signature LONGTEXT NOT NULL COMMENT \'Vérification des doublons\', geometry LONGTEXT DEFAULT NULL COMMENT \'Localisation précise de l\'\'obs\', elevation INT DEFAULT NULL COMMENT \'Altitude\', geodatum VARCHAR(255) DEFAULT \'WGS84\' COMMENT \'Système géodésique\', locality VARCHAR(255) DEFAULT NULL COMMENT \'Localité où se trouve l\'\'obs\', locality_insee_code VARCHAR(255) DEFAULT NULL COMMENT \'Code INSEE de la localité où se trouve l\'\'obs\', sublocality VARCHAR(255) DEFAULT NULL COMMENT \'Lieu-dit\', environment VARCHAR(255) DEFAULT NULL COMMENT \'Milieu, type d\'\'habitat\', locality_consistency TINYINT(1) DEFAULT NULL COMMENT \'Cohérence entre les coordonnées et la localité\', station VARCHAR(255) DEFAULT NULL COMMENT \'The string to show in the dropdown \', published_location ENUM(\'précise\', \'localité\', \'10x10km\') DEFAULT \'précise\' COMMENT \'Précision géographique à laquelle est publiée l\'\'obs, permet de gérer le floutage(DC2Type:publishedlocationenum)\', location_accuracy ENUM(\'0 à 10 m\', \'10 à 100 m\', \'100 à 500 m\', \'Lieu-dit\', \'Localité\') DEFAULT NULL COMMENT \'Précision (ou incertitude) de la localisation(DC2Type:locationaccuracytypeenum)\', osm_county VARCHAR(255) DEFAULT NULL COMMENT \'Champ complété automatiquement par osm - comté\', osm_state VARCHAR(255) DEFAULT NULL COMMENT \'Champ complété automatiquement par osm - état\', osm_postcode VARCHAR(255) DEFAULT NULL COMMENT \'Champ complété automatiquement par osm - code postal\', osm_country VARCHAR(255) DEFAULT NULL COMMENT \'Champ complété automatiquement par osm - pays\', osm_country_code VARCHAR(255) DEFAULT NULL COMMENT \'Champ complété automatiquement par osm - code pays\', osm_id BIGINT DEFAULT NULL COMMENT \'Champ complété automatiquement par osm - id osm\', osm_place_id INT DEFAULT NULL COMMENT \'Champ complété automatiquement par osm - id de l\'\'instance géographique\', identiplante_score INT DEFAULT 0 COMMENT \'Score de l\'\'observation sur identiplante\', is_identiplante_validated TINYINT(1) DEFAULT \'0\' NOT NULL COMMENT \'Statut validé (ou non) de l\'\'observation sur identiplante\', identification_author VARCHAR(100) DEFAULT NULL COMMENT \'Nom de la personne ayant identifié l\'\'espèce observée (si différente de l\'\'observateur)\', taxo_repo VARCHAR(20) DEFAULT \'\' COMMENT \'Référentiel taxonomique\', INDEX IDX_BEFD81F3166D1F9C (project_id), INDEX user_id_idx (user_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB');
        $this->addSql('CREATE TABLE photo (id INT AUTO_INCREMENT NOT NULL, occurrence_id INT DEFAULT NULL, user_id INT DEFAULT NULL COMMENT \'ID de l\'\'utilisateur\', user_email VARCHAR(255) NOT NULL COMMENT \'Email de l\'\'utilisateur\', user_pseudo VARCHAR(255) DEFAULT NULL COMMENT \'Pseudo de l\'\'utilisateur propriétaire de la photo. Nom/Prénom si non renseigné.\', original_name VARCHAR(255) NOT NULL COMMENT \'Nom du fichier image\', date_shot DATETIME DEFAULT NULL COMMENT \'Date de la prise de vue\', latitude DOUBLE PRECISION DEFAULT NULL COMMENT \'Latitude de la photo\', longitude DOUBLE PRECISION DEFAULT NULL COMMENT \'Longitude de la photo\', date_created DATETIME NOT NULL COMMENT \'Date de l\'\'import du fichier\', date_updated DATETIME DEFAULT NULL COMMENT \'Date de dernière modification\', date_linked_to_occurrence DATETIME DEFAULT NULL COMMENT \'Date à laquelle la photo a été liée à une obs\', content_url VARCHAR(255) NOT NULL, size INT NOT NULL COMMENT \'La taille du fichier en kb.\', mime_type VARCHAR(255) NOT NULL COMMENT \'Le type MIME associé à la photo.\', url VARCHAR(255) NOT NULL COMMENT \'URL du fichier.\', INDEX IDX_14B7841830572FAC (occurrence_id), INDEX user_id_idx (user_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB COMMENT = \'Les noms originaux doivent être uniques pour un même utilisateur.\' ');
        $this->addSql('CREATE TABLE project_settings (id INT AUTO_INCREMENT NOT NULL, project_id INT DEFAULT NULL, project VARCHAR(25) NOT NULL, title VARCHAR(255) DEFAULT NULL COMMENT \'Titre du wigdet à afficher\', logo VARCHAR(255) DEFAULT NULL COMMENT \'Logo du projet\', language VARCHAR(2) NOT NULL COMMENT \'Langue du projet\', description LONGTEXT DEFAULT NULL, taxo_restriction_value VARCHAR(255) DEFAULT NULL COMMENT \'Liste de valeurs possibles pour le taxon. Prend la forme \'\'repository_name: taxoId1,taxoId2, ...,taxoIdn\'\'\', type VARCHAR(255) DEFAULT NULL, is_type TINYINT(1) DEFAULT NULL, css_style VARCHAR(255) DEFAULT NULL, image_font VARCHAR(255) DEFAULT NULL, date_created DATETIME NOT NULL COMMENT \'Date de création du widget\', date_updated DATETIME DEFAULT NULL COMMENT \'Date de dernière modif du widget\', taxo_restriction_type VARCHAR(255) NOT NULL COMMENT \'Niveau de restriction pour la saisie du taxon : un seul taxon sélectionnable, plusieurs, un référentiel\', location_type VARCHAR(50) NOT NULL COMMENT \' Le type de zone géographique concernée par le projet\', location VARCHAR(255) DEFAULT NULL, environment VARCHAR(255) DEFAULT NULL COMMENT \'Valeur(s) par défaut du champ \'\'environment\'\' (milieux) de toutes les obs du projet\', info VARCHAR(15) DEFAULT NULL, published_location ENUM(\'précise\', \'localité\', \'10x10km\') DEFAULT \'10x10km\' COMMENT \'Précision géographique à laquelle est publiée l\'\'obs, permet de gérer le floutage(DC2Type:publishedlocationenum)\', project_tag_name VARCHAR(255) DEFAULT NULL COMMENT \'Un tag par défaut est associé à toutes les obs du projet\', INDEX IDX_D80B2B1E166D1F9C (project_id), UNIQUE INDEX id_project_lang (project, language), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB COMMENT = \'Info pour configurer le widget de saisie - la clé primaire est le nom du projet + la langue\' ');
        $this->addSql('CREATE TABLE tb_project (id INT AUTO_INCREMENT NOT NULL, parent_id INT DEFAULT NULL, label VARCHAR(255) NOT NULL COMMENT \'Intitulé du projet\', is_private TINYINT(1) NOT NULL COMMENT \'Indique si tout le monde peut contribuer au projet (\'\'false\'\') ou seulement les admin (\'\'true\'\')\', UNIQUE INDEX UNIQ_50640A4C727ACA70 (parent_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB');
        $this->addSql('CREATE TABLE user_custom_field_occurrence (id INT AUTO_INCREMENT NOT NULL, occurrence_id INT NOT NULL, user_custom_field_id INT NOT NULL, value LONGTEXT NOT NULL COMMENT \'Valeur renseignée par l\'\'utilisateur\', INDEX IDX_27C0824930572FAC (occurrence_id), INDEX IDX_27C08249B3398C5B (user_custom_field_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB');
        $this->addSql('CREATE TABLE user_profile_cel (id INT AUTO_INCREMENT NOT NULL, user_id INT NOT NULL, anonymize_data TINYINT(1) DEFAULT \'0\' NOT NULL COMMENT \'Anonymisation des données d\'\'observation\', is_end_user_licence_accepted TINYINT(1) DEFAULT \'1\' NOT NULL COMMENT \'Validation des conditions d\'\'utilisation\', always_display_advanced_fields TINYINT(1) DEFAULT \'0\' NOT NULL COMMENT \'Validation des conditions d\'\'utilisation\', language ENUM(\'EN\', \'FR\') DEFAULT \'FR\' NOT NULL COMMENT \'langage choisi pour communiquer dans l\'\'interface.(DC2Type:languageenum)\', UNIQUE INDEX UNIQ_EEE77E50A76ED395 (user_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB COMMENT = \'Gestion des préférences utilisateurs\' ');
        $this->addSql('ALTER TABLE extended_field ADD CONSTRAINT FK_76A19DBE166D1F9C FOREIGN KEY (project_id) REFERENCES tb_project (id)');
        $this->addSql('ALTER TABLE extended_field_occurrence ADD CONSTRAINT FK_7DFE29EF30572FAC FOREIGN KEY (occurrence_id) REFERENCES occurrence (id)');
        $this->addSql('ALTER TABLE extended_field_occurrence ADD CONSTRAINT FK_7DFE29EFCCBF7175 FOREIGN KEY (extended_field_id) REFERENCES extended_field (id)');
        $this->addSql('ALTER TABLE extendedfield_translation ADD CONSTRAINT FK_169442A8CCBF7175 FOREIGN KEY (extended_field_id) REFERENCES extended_field (id)');
        $this->addSql('ALTER TABLE occurrence ADD CONSTRAINT FK_BEFD81F3166D1F9C FOREIGN KEY (project_id) REFERENCES tb_project (id)');
        $this->addSql('ALTER TABLE photo ADD CONSTRAINT FK_14B7841830572FAC FOREIGN KEY (occurrence_id) REFERENCES occurrence (id)');
        $this->addSql('ALTER TABLE project_settings ADD CONSTRAINT FK_D80B2B1E166D1F9C FOREIGN KEY (project_id) REFERENCES tb_project (id)');
        $this->addSql('ALTER TABLE tb_project ADD CONSTRAINT FK_50640A4C727ACA70 FOREIGN KEY (parent_id) REFERENCES tb_project (id)');
        $this->addSql('ALTER TABLE user_custom_field_occurrence ADD CONSTRAINT FK_27C0824930572FAC FOREIGN KEY (occurrence_id) REFERENCES occurrence (id)');
        $this->addSql('ALTER TABLE user_custom_field_occurrence ADD CONSTRAINT FK_27C08249B3398C5B FOREIGN KEY (user_custom_field_id) REFERENCES user_custom_field (id)');
        $this->addSql('ALTER TABLE occurrence_user_occurrence_tag ADD CONSTRAINT FK_B06FBA5830572FAC FOREIGN KEY (occurrence_id) REFERENCES occurrence (id)');
        $this->addSql('ALTER TABLE occurrence_user_occurrence_tag ADD CONSTRAINT FK_B06FBA58768D75C5 FOREIGN KEY (user_occurrence_tag_id) REFERENCES user_occurrence_tag (id)');
        $this->addSql('ALTER TABLE occurrence_validation ADD CONSTRAINT FK_C8C4281C30572FAC FOREIGN KEY (occurrence_id) REFERENCES occurrence (id)');
        $this->addSql('ALTER TABLE photo_tag_photo ADD CONSTRAINT FK_3BA5CB3F7E9E4C8C FOREIGN KEY (photo_id) REFERENCES photo (id)');
        $this->addSql('ALTER TABLE photo_tag_photo ADD CONSTRAINT FK_3BA5CB3FEF6D1439 FOREIGN KEY (photo_tag_id) REFERENCES photo_tag (id)');
    }

    public function down(Schema $schema) : void
    {
        // this down() migration is auto-generated, please modify it to your needs
        $this->addSql('ALTER TABLE extended_field_occurrence DROP FOREIGN KEY FK_7DFE29EFCCBF7175');
        $this->addSql('ALTER TABLE extendedfield_translation DROP FOREIGN KEY FK_169442A8CCBF7175');
        $this->addSql('ALTER TABLE extended_field_occurrence DROP FOREIGN KEY FK_7DFE29EF30572FAC');
        $this->addSql('ALTER TABLE occurrence_user_occurrence_tag DROP FOREIGN KEY FK_B06FBA5830572FAC');
        $this->addSql('ALTER TABLE occurrence_validation DROP FOREIGN KEY FK_C8C4281C30572FAC');
        $this->addSql('ALTER TABLE photo DROP FOREIGN KEY FK_14B7841830572FAC');
        $this->addSql('ALTER TABLE user_custom_field_occurrence DROP FOREIGN KEY FK_27C0824930572FAC');
        $this->addSql('ALTER TABLE photo_tag_photo DROP FOREIGN KEY FK_3BA5CB3F7E9E4C8C');
        $this->addSql('ALTER TABLE extended_field DROP FOREIGN KEY FK_76A19DBE166D1F9C');
        $this->addSql('ALTER TABLE occurrence DROP FOREIGN KEY FK_BEFD81F3166D1F9C');
        $this->addSql('ALTER TABLE project_settings DROP FOREIGN KEY FK_D80B2B1E166D1F9C');
        $this->addSql('ALTER TABLE tb_project DROP FOREIGN KEY FK_50640A4C727ACA70');
        $this->addSql('DROP TABLE change_log');
        $this->addSql('DROP TABLE extended_field');
        $this->addSql('DROP TABLE extended_field_occurrence');
        $this->addSql('DROP TABLE extendedfield_translation');
        $this->addSql('DROP TABLE occurrence');
        $this->addSql('DROP TABLE photo');
        $this->addSql('DROP TABLE project_settings');
        $this->addSql('DROP TABLE tb_project');
        $this->addSql('DROP TABLE user_custom_field_occurrence');
        $this->addSql('DROP TABLE user_profile_cel');
        $this->addSql('ALTER TABLE occurrence_user_occurrence_tag DROP FOREIGN KEY FK_B06FBA58768D75C5');
        $this->addSql('ALTER TABLE photo_tag_photo DROP FOREIGN KEY FK_3BA5CB3FEF6D1439');
    }
}
